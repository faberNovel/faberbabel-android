apply plugin: 'maven-publish'
apply from: '../publishing.gradle'

ext.release = [
    versionName     : "1.0.0-SNAPSHOT",
    groupId         : "com.fabernovel.faberbabel",
    moduleArtifactId: "faberbabel"
]

task sourcesJar(type: Jar) {
    classifier = 'sources'
    from android.sourceSets.main.java.srcDirs
}

project.afterEvaluate {
    publishing {
        publications {
            maven(MavenPublication) {
                groupId = release.groupId
                artifactId = release.moduleArtifactId
                version = getVersionName()
                artifact sourcesJar
                artifact bundleReleaseAar
                pom {
                    // TODO add license for release
                }
            }
        }
        repositories {
            maven {
                def awsCredentials = fetchAwsCredentials()

                url "s3://ft-maven-repo.s3.amazonaws.com/snapshot"
                credentials(AwsCredentials) {
                    accessKey = awsCredentials.AWSAccessKeyId
                    secretKey = awsCredentials.AWSSecretKey
                }
            }
        }
    }
}


private String getVersionName() {
    return "${release.versionName}" + "-" + System.getenv('COMMIT_HASH')
}
